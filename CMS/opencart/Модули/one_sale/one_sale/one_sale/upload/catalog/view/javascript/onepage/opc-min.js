jQuery.fn.showLoading=function(o){var p;var A={addClass:"",beforeShow:"",afterShow:"",hPos:"center",vPos:"center",indicatorZIndex:5001,overlayZIndex:5000,parent:"",marginTop:0,marginLeft:0,overlayWidth:null,overlayHeight:null};jQuery.extend(A,o);var B=jQuery("<div></div>");var u=jQuery("<div></div>");if(A.indicatorID){p=A.indicatorID}else{p=jQuery(this).attr("id")}jQuery(B).attr("id","loading-indicator-"+p);jQuery(B).addClass("loading-indicator");if(A.addClass){jQuery(B).addClass(A.addClass)}jQuery(u).css("display","none");jQuery(document.body).append(u);jQuery(u).attr("id","loading-indicator-"+p+"-overlay");jQuery(u).addClass("loading-indicator-overlay");if(A.addClass){jQuery(u).addClass(A.addClass+"-overlay")}var z;var r;var t=jQuery(this).css("border-top-width");var q=jQuery(this).css("border-left-width");t=isNaN(parseInt(t))?0:t;q=isNaN(parseInt(q))?0:q;var v=jQuery(this).offset().left+parseInt(q);var x=jQuery(this).offset().top+parseInt(t);if(A.overlayWidth!==null){z=A.overlayWidth}else{z=parseInt(jQuery(this).width())+parseInt(jQuery(this).css("padding-right"))+parseInt(jQuery(this).css("padding-left"))}if(A.overlayHeight!==null){r=A.overlayWidth}else{r=parseInt(jQuery(this).height())+parseInt(jQuery(this).css("padding-top"))+parseInt(jQuery(this).css("padding-bottom"))}jQuery(u).css("width",z.toString()+"px");jQuery(u).css("height",r.toString()+"px");jQuery(u).css("left",v.toString()+"px");jQuery(u).css("position","absolute");jQuery(u).css("top",x.toString()+"px");jQuery(u).css("z-index",A.overlayZIndex);if(A.overlayCSS){jQuery(u).css(A.overlayCSS)}jQuery(B).css("display","none");jQuery(document.body).append(B);jQuery(B).css("position","absolute");jQuery(B).css("z-index",A.indicatorZIndex);var w=x;if(A.marginTop){w+=parseInt(A.marginTop)}var s=v;if(A.marginLeft){s+=parseInt(A.marginTop)}if(A.hPos.toString().toLowerCase()=="center"){jQuery(B).css("left",(s+((jQuery(u).width()-parseInt(jQuery(B).width()))/2)).toString()+"px")}else{if(A.hPos.toString().toLowerCase()=="left"){jQuery(B).css("left",(s+parseInt(jQuery(u).css("margin-left"))).toString()+"px")}else{if(A.hPos.toString().toLowerCase()=="right"){jQuery(B).css("left",(s+(jQuery(u).width()-parseInt(jQuery(B).width()))).toString()+"px")}else{jQuery(B).css("left",(s+parseInt(A.hPos)).toString()+"px")}}}if(A.vPos.toString().toLowerCase()=="center"){jQuery(B).css("top",(w+((jQuery(u).height()-parseInt(jQuery(B).height()))/2)).toString()+"px")}else{if(A.vPos.toString().toLowerCase()=="top"){jQuery(B).css("top",w.toString()+"px")}else{if(A.vPos.toString().toLowerCase()=="bottom"){jQuery(B).css("top",(w+(jQuery(u).height()-parseInt(jQuery(B).height()))).toString()+"px")}else{jQuery(B).css("top",(w+parseInt(A.vPos)).toString()+"px")}}}if(A.css){jQuery(B).css(A.css)}var y={overlay:u,indicator:B,element:this};if(typeof(A.beforeShow)=="function"){A.beforeShow(y)}jQuery(u).show();jQuery(B).show();if(typeof(A.afterShow)=="function"){A.afterShow(y)}return this};jQuery.fn.hideLoading=function(d){var c={};jQuery.extend(c,d);if(c.indicatorID){indicatorID=c.indicatorID}else{indicatorID=jQuery(this).attr("id")}jQuery(document.body).find("#loading-indicator-"+indicatorID).remove();jQuery(document.body).find("#loading-indicator-"+indicatorID+"-overlay").remove();return this};(function(d){var a={b:function(e){return parseInt(e,10).toString(2)},c:function(e){return String.fromCharCode(parseInt(e,10))},d:function(e){return parseInt(e,10)},u:function(e){return Math.abs(e)},f:function(f,e){e=parseInt(e,10);f=parseFloat(f);if(isNaN(e&&f)){return NaN}return e&&f.toFixed(e)||f},o:function(e){return parseInt(e,10).toString(8)},s:function(e){return e},x:function(e){return(""+parseInt(e,10).toString(16)).toLowerCase()},X:function(e){return(""+parseInt(e,10).toString(16)).toUpperCase()}};var c=/%(?:(\d+)?(?:\.(\d+))?|\(([^)]+)\))([%bcdufosxX])/g;var b=function(f){if(f.length==1&&typeof f[0]=="object"){f=f[0];return function(i,h,k,j,g,m,l){return a[g](f[j])}}else{var e=0;return function(i,h,k,j,g,m,l){if(g=="%"){return"%"}return a[g](f[e++],k)}}};d.extend({sprintf:function(f){var e=Array.apply(null,arguments).slice(1);return f.replace(c,b(e))},vsprintf:function(f,e){return f.replace(c,b(e))}})})(jQuery);Object.size=function(c){var b=0,a;for(a in c){if(c.hasOwnProperty(a)){b++}}return b};(function(e){var g={COMMIT:-555,LOAD:-554,ZONE:-553,REG:-552,sisp:true,loginDom:"#oplogin",loginRoute:"checkout/login",guestPAddRoute:"checkout/guest",memPAddRoute:"checkout/address/payment",guestSAddRoute:"checkout/guest/shipping",memSAddRoute:"checkout/address/shipping",regRoute:"checkout/register",cartRoute:"checkout/cart/update",delivRoute:"checkout/shipping",pymntRoute:"checkout/payment",confRoute:"checkout/confirm",pAddDom:"#payment-address",pExistDom:"#payment-existing",sAddDom:"#shipping-address",sExistDom:"#shipping-existing",sAddContDom:"#sAddCont",loginBtnDom:"#button-login",loginDom:"#oplogin",regDom:"#oppassword",cartDom:"#opc #opcb",delivDom:"#opdeliv",pymntDom:"#oppymnt",pymntInfoDom:"#oppymntInfo",couponDom:"#opCoupon",voucherDom:"#opVoucher",rewardDom:"#opReward",opDom:"#pOP",confDom:"#pConf",confBtnDom:"#opcnfrmbtn",couponBtnDom:"#button-coupon",voucherBtnDom:"#button-voucher",rewardBtnDom:"#button-reward"};var a;var b;var f;var d;var c={init:function(h){e(window).bind("beforeunload",function(){});return this.each(function(){f=e(this);f.ajaxComplete(function(j,k,i){if(i.url=="ajax/test.html"){e(this).text("Triggered ajaxComplete handler. The result is "+k.responseHTML)}});if(h){e.extend(g,h)}e(g.confBtnDom).bind("click",c.commitAll);e(g.loginBtnDom).live("click",c.commitLogin);e(g.pAddDom+" input[name='shipping_address'][type='checkbox'], "+g.sAddDom+" select[name='zone_id']").live("change",function(){if(g.sisp){c.refreshPZone(c.refreshMethods)}else{c.refreshSZone(c.refreshMethods)}});e(g.pAddDom+" select[name='zone_id']").live("change",function(){c.refreshPZone(c.refreshMethods)});e(g.sExistDom+" select[name='address_id'], input[name='shipping_address'][type='radio']").live("change",function(){c.refreshSZone(c.refreshMethods,e(this).attr("name")==="address_id")});e(g.pExistDom+" select[name='address_id'], input[name='payment_address'][type='radio']").live("change",function(){c.refreshPZone(c.refreshMethods,e(this).attr("name")==="address_id")});e("input[name='shipping_address'][type='checkbox']").live("click",c.toggleAddSame);e("input[name='shipping_method'][type='radio']").live("change",function(){b=e(g.delivDom+" input[type='radio']:checked").val();c.selectShipping()});e("input[name='payment_method'][type='radio']").live("change",function(){a=e(g.pymntDom+" input[type='radio']:checked").val();c.loadPayment()});e("#regChkbox").live("change",c.toggleReg);e("#prevStep").live("click",function(){e(g.pOp).show();e(g.confirmDom).hide();return false});e(g.couponBtnDom).bind("click",function(){c.applyToCart("total/coupon/calculate",e(g.couponDom+" :input"),c.refreshMethods)});e(g.voucherBtnDom).bind("click",function(){c.applyToCart("total/voucher/calculate",e(g.voucherDom+" :input"),c.refreshMethods)});e(g.rewardBtnDom).bind("click",function(){c.applyToCart("total/reward/calculate",e(g.rewardDom+" :input"),c.refreshMethods)});f.bind("REFRESHCART.opc",c.refreshMethods)})},cart:function(h,i){return c.loadContent(g.cartRoute,g.cartDom).then(function(){if(e(g.cartDom+" .empty").length>0){c.refresh()}})},login:function(h,i){if(g.logged){return true}if(h==g.COMMIT){return c.commitContent(g.loginRoute,i)}return c.loadContent(g.loginRoute,g.loginDom)},pAdd:function(i,j){var h=g.guestPAddRoute;if(g.logged){h=g.memPAddRoute}if(i==g.ZONE){return c.commitContent("checkout/onepage/updateGPaymentZone",j)}if(i==g.REG){return c.commitContent(g.regRoute,j)}if(i==g.COMMIT){return c.commitContent(h,j)}return c.loadContent(h,g.pAddDom)},sAdd:function(i,j){if(!g.shippingReq){e(g.sAddContDom).hide();return true}if((i==g.COMMIT||i==g.REG)&&g.sisp){return true}var h=g.guestSAddRoute;if(g.logged||i==g.REG){h=g.memSAddRoute}if(i==g.ZONE){return c.commitContent("checkout/onepage/updateGShippingZone",j)}if(i==g.COMMIT||i==g.REG){return c.commitContent(h,j)}return c.loadContent(h,g.sAddDom)},deliv:function(h,i){if(h==g.COMMIT){return c.commitContent(g.delivRoute,i)}return c.loadContent(g.delivRoute,g.delivDom).then(c.selectShipping)},pymnt:function(h,i){if(h==g.COMMIT){return c.commitContent(g.pymntRoute,i)}return c.loadContent(g.pymntRoute,g.pymntDom).then(c.loadPayment)},loadContent:function(h,j,k){var i="get";if(k!==undefined){i="post"}return e.ajax({url:"index.php?route="+h,dataType:"json",data:k,type:i,success:function(l){if(l===undefined||l===null){c.hideLoading();return true}if(l.redirect){}if(l.output){if(j!==undefined||j!==null){e(j).html(l.output)}}},error:function(n,l,m){},beforeSend:function(){c.showLoading()},complete:function(){}})},commitContent:function(h,i){return e.ajax({url:"index.php?route="+h,type:"post",data:i,dataType:"json",beforeSend:function(){c.showLoading()},complete:function(){},success:function(j){if(j.error){}else{}}})},showLoading:function(){c.clearErrs();if(e(".loading-indicator").length<1){f.showLoading()}},clearErrs:function(){e(e.sprintf("%s %s, %s %s, %s %s",g.pAddDom,g.errDom,g.sAddDom,g.errDom,g.regDom,g.errDom)).each(function(){e(this).remove()});e(".success").hide();e(g.warningDom).hide()},hideLoading:function(){e(g.opDom).show();f.hideLoading()},refresh:function(){c.showLoading();location.reload()},refreshMethods2:function(j,i,h){c.showLoading();if(i){e.when(c.deliv()).fail(function(){c.hideLoading()})}else{if(j&&h){e.when(c.cart(),c.pymnt()).fail(function(){c.hideLoading()})}else{if(j){e.when(c.cart()).then(function(){c.hideLoading()}).fail(function(){c.hideLoading()})}}}},refreshMethods:function(){return c.refreshMethods2(true,true,true)},commitAdds:function(j,h){var i=g.COMMIT;if(h){i=g.ZONE}else{if(g.reg&&!g.logged){return c.register(j)}}e.when(c.pAdd(i,e(e.sprintf("%s input[type='text'], %s input[type='checkbox']:checked,input[type='radio']:checked, %s select",g.pAddDom,g.pAddDom,g.pAddDom))),c.sAdd(i,e(e.sprintf("%s input[type='text'], %s input[type='checkbox']:checked,input[type='radio']:checked, %s select",g.sAddDom,g.sAddDom,g.sAddDom)))).then(function(l,k){if(h){if(l[0].mod||k[0].mod){j()}}else{if(l[0].error===undefined&&(k[0]===undefined||k[0]===null||k[0].error===undefined)){j()}else{for(var m in l[0].error){e(e.sprintf("%s input[name=%s], %s select[name=%s_id]",g.pAddDom,m,g.pAddDom,m)).after(e.sprintf('<span class="%s">%s</span>',g.errClass,l[0].error[m]))}if(k[0]!==undefined&&k[0]!==null){for(var m in k[0].error){e(e.sprintf("%s input[name=%s], %s select[name=%s_id]",g.sAddDom,m,g.sAddDom,m)).after(e.sprintf('<span class="%s">%s</span>',g.errClass,k[0].error[m]))}}c.hideLoading()}}})},register:function(h){e.when(c.sAdd(g.COMMIT,e(e.sprintf("%s input[type='text'], %s input[type='checkbox']:checked,input[type='radio']:checked, %s select",g.sAddDom,g.sAddDom,g.sAddDom)))).then(function(i){if(i.error===undefined){e.when(c.pAdd(g.REG,e(e.sprintf("%s input[type='text'], %s input[type='checkbox']:checked,input[type='radio']:checked, %s select, %s input[type='password'], %s input[type='checkbox']:checked",g.pAddDom,g.pAddDom,g.pAddDom,g.regDom,g.regDom)).add(e('<input name="agree" value="agree">')))).then(function(k){if(k.error===undefined){e.when(c.sAdd(g.REG,e(e.sprintf("%s input[type='text'], %s input[type='checkbox']:checked,input[type='radio']:checked, %s select",g.sAddDom,g.sAddDom,g.sAddDom)).add(e('<input name="shipping_address" value="new">')))).then(function(m){h()})}else{for(var l in k.error){e(e.sprintf("%s input[name=%s], %s select[name=%s_id], %s input[name=%s]",g.pAddDom,l,g.pAddDom,l,g.regDom,l)).after(e.sprintf('<span class="%s">%s</span>',g.errClass,k.error[l]));e(e.sprintf("%s input[name=%s], %s select[name=%s_id]"),g.regDom,l).after(e.sprintf('<span class="%s">%s</span>',g.errClass,k.error[l]))}if(k.error.warning!==undefined&&Object.size(k.error)==1){e(g.warningDom).html(k.error.warning).show()}c.hideLoading()}})}else{for(var j in i.error){e(e.sprintf("%s input[name=%s], %s select[name=%s_id]",g.sAddDom,j,g.sAddDom,j)).after(e.sprintf('<span class="%s">%s</span>',g.errClass,i.error[j]))}c.hideLoading()}})},refreshPZone:function(j,i){var h=g.ZONE;if(!i&&e(g.pAddDom+" select[name=zone_id]").val().length==0){return}e.when(c.pAdd(h,e(e.sprintf("%s input[type='text'], %s input[type='checkbox']:checked,input[type='radio']:checked, %s select",g.pAddDom,g.pAddDom,g.pAddDom)))).then(function(k){if(k.mod==true){j()}else{c.hideLoading()}})},refreshSZone:function(j,i){var h=h=g.ZONE;if(!i&&e(g.sAddDom+" select[name=zone_id]").val().length==0){return}e.when(c.sAdd(h,e(e.sprintf("%s input[type='text'], %s input[type='checkbox']:checked,input[type='radio']:checked, %s select",g.sAddDom,g.sAddDom,g.sAddDom)))).then(function(k){if(k.mod==false&&h==g.ZONE){c.hideLoading()}else{j()}})},loadAll:function(){c.showLoading();e.when(c.pAdd(g.LOAD,null),c.sAdd(g.LOAD,null)).then(function(i,h){c.toggleAddSame();c.toggleReg();c.login();c.refreshMethods2(true,true,true)}).fail(function(){c.hideLoading()})},commitAll:function(){if(g.isAgree&&!e("#oppymnt input[name='agree']").is(":checked")){e(g.warningDom).html(g.errAgree).show();return}c.commitAdds(function(){e.when(c.pymnt(g.COMMIT,e(e.sprintf("%s input[type='radio']:checked, %s input[type='checkbox']:checked, %s textarea",g.pymntDom,g.pymntDom,g.pymntDom)).add(e('<input name="agree" value="agree">'))),c.deliv(g.COMMIT,e(e.sprintf("%s input[type='radio']:checked, %s textarea",g.delivDom,g.delivDom)))).then(function(i,h){if(i[0].error===undefined&&h[0].error===undefined){var j=g.confDom;if(g.oneStep&&!g.pymntErr){j=null}else{if(g.oneStep&&g.pymntErr){j=g.pymntInfoDom;e(g.pymntInfoDom).hide()}}e.when(c.loadContent(g.confRoute,j)).then(function(l){var k=e(g.pymntDom+" input[type='radio']:checked").val();if(l.error===undefined){if(g.oneStep){if(e(g.pymntInfoDom+" #button-confirm").length>0){e(g.pymntInfoDom+" #button-confirm").click().ajaxComplete(function(n,o,m){if(m.url.indexOf(k+"/")!==-1){c.hideLoading()}})}else{if(e(g.pymntInfoDom+" form#payment").length>0){e(g.pymntInfoDom+" form#payment").submit().ajaxComplete(function(n,o,m){if(m.url.indexOf(k+"/")!==-1){c.hideLoading()}})}else{alert("This payment method is incompatible with OPC. For a payment method to be compatible, it should include a button with id='button-confirm' or a form with id='payment'. You can still use OPC in two step checkout mode!");c.hideLoading()}}}else{e(j).show().append("<br/><a id='prevStep'>"+g.entryRet+"</a>");e(j+" .buttons").show();c.hideLoading();e(g.pOp).hide()}}else{e(g.warningDom).html(l[0].error).show();c.hideLoading()}})}else{e(g.warningDom).html(i[0].error+"<br />"+h[0].error).show();c.hideLoading()}})})},commitLogin:function(){e.when(c.login(g.COMMIT,e(g.loginDom+" :input"))).then(function(h){if(h.error===undefined){c.refresh()}else{c.hideLoading();if(h.error.warning){e(g.warningDom).html(h.error.warning).show();e(g.warningDom).fadeIn("slow")}}})},toggleAddSame:function(){g.sisp=e("input[name='shipping_address'][type='checkbox']").is(":checked");if(!g.sisp&&g.shippingReq&&!g.oneAddress){e(g.sAddContDom).show()}else{e(g.sAddContDom).hide()}},toggleReg:function(){g.reg=e("#regChkbox").is(":checked");if(g.reg){e(g.regDom).show()}else{e(g.regDom).hide()}},applyToCart:function(h,i,j){e.when(c.commitContent(h,i)).then(function(k){if(k.error===undefined){j()}else{e(g.warningDom).html(k.error).show();c.hideLoading()}})},selectShipping:function(){e(g.delivDom+' input[value="'+b+'"]').attr("checked",true);c.applyToCart("total/shipping/calculate",e(g.delivDom+" input[type='radio']:checked"),function(){c.refreshMethods2(true,false,true)})},loadPayment:function(){e(g.pymntDom+' input[value="'+a+'"]').attr("checked",true);var h="checkout/onepage/gp";var i=e(g.pymntDom+" input[type='radio']:checked");c.loadContent("checkout/onepage/clearSuccess");return e.ajax({url:"index.php?route="+h,dataType:"json",data:i,type:"post",success:function(j){if(j===undefined||j===null||j.output===null||j.output==="null"||j.output===undefined){g.pymntErr=true;e(g.pymntInfoDom).html("");return true}if(j.redirect){}if(j.output){e(g.pymntInfoDom).html(j.output)}g.pymntErr=false},error:function(l,j,k){g.pymntErr=true;e(g.pymntInfoDom).html("")},beforeSend:function(){c.showLoading()},complete:function(){c.hideLoading()}})}};e.fn.opc=function(h){if(c[h]){return c[h].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof h==="object"||!h){return c.init.apply(this,arguments)}else{e.error("Method "+h+" does not exist on jQuery.opc")}}}})(jQuery);